---
title: "Immigration Policy Graphic"
author: "Simone Chu"
date: "4/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(sf)
library(fs)
library(forcats)
library(ggplot2)
library(ggthemes)
library(gganimate)
library(tidyverse)
```

### A brief explanation of the project

I plan to compare ethnic diversity of various countries with their immigration policy, because I'm curious to see whether or not ethnic diversity impacts how open a country is to immigration. This graphic deals with one part of the data -- ethnic diversity based on linguistic diversity, courtesy of Ethnologue. 

Later on, I plan to overlay maps with ethnic diversity and the ability to see how open these countries' immigration policies are. But for now: 

```{r, getting_data, include=FALSE, warning=FALSE, cache=TRUE}

qog <- read_csv("qog_std_cs_jan18copy.csv",
                col_types = cols(
                   .default = col_character(),
                   turnout_scale = col_double(),
                   turnout_score = col_double(),
                   w_LV = col_double(),
                   w_RV = col_double(),
                   final_weight = col_double(),
                   timestamp = col_datetime(format = ""))) %>%
  select(cname, fe_cultdiv, fe_etfra, wdi_migration, unna_gdppc) %>%
  filter(cname %in% c("Austria", "Australia", "Belgium", "Canada",
                        "Switzerland", "Chile", "Czech Republic",
                        "Germany", "Denmark", "Estonia", "Spain",
                        "Finland", "France (1963-)", "United Kingdom", "Greece",
                        "Hungary", "Ireland", "Israel", "Iceland",
                        "Italy", "Japan", "Korea, South", "Mexico",
                        "Luxembourg", "Netherlands", "Norway", "New Zealand",
                        "Poland", "Portugal", "Sweden", "Slovakia",
                        "Turkey", "United States")) %>%

    # I filtered for the 33 countries that have data in the IMPIC dataset. It took a little bit
    # of trial and error, because the names of countries were denoted differently in this dataset
    # than in the IMPIC dataset, but I eventually found the ones I wanted. 

    # However, because the Qualities of Governent dataset doesn't have information on ethnic
    # diversity in Iceland and Luxembourg, I'll be excluding those countries from my analysis 
    # of immigration policy later on. 
  
  mutate(cname = fct_recode(cname, "France" = "France (1963-)", "South Korea" = "Korea, South")) %>%

    # I don't like the irregularity in the country names, so I recoded the relevant factors. 

  mutate(wdi_migration = as.numeric(wdi_migration),
         unna_gdppc = as.numeric(unna_gdppc),
         fe_cultdiv = as.numeric(fe_cultdiv),
         fe_etfra = as.numeric(fe_etfra))

    # When I first tried to plot this, the graph looked weird -- and that's when I realized all the columns were characters instead of numbers. Wild. 

policy_data <- read_csv("impic2016.csv") %>%
  select(cntry, cntryID, year, AvgS_a04, AvgS_c03, AvgS_d03_1, AvgS_e05, AvgS_e04) %>%
  mutate(cntry = fct_recode(cntry, "Austria" = "at", "Australia" = "au", "Belgium" = "be",
                            "Canada" = "ca", "Switzerland" = "ch", "Chile" = "cl",
                            "Czech Republic" = "cz", "Germany" = "de", "Denmark" = "dk",
                            "EU Directives" = "eu", "Estonia" = "ee", "EU Regulation" = "er",
                            "Spain" = "es", "Finland" = "fi", "France" = "fr", 
                            "United Kingdom" = "gb", "Greece" = "gr", "Hungary" = "hu",
                            "Ireland" = "ie", "Israel" = "il", "Iceland" = "is",
                            "Italy" = "it", "Japan" = "jp", "South Korea" = "kr",
                            "Luxembourg" = "lu", "Mexico" = "mx", "Netherlands" = "nl",
                            "Norway" = "no", "New Zealand" = "nz", "Poland" = "pl",
                            "Portugal" = "pt", "Sweden" = "se", "Slovakia" = "sk",
                            "Turkey" = "tr", "United States" = "us"))

    # Recoded the country names so that I can more easily identify which data goes for each
    # country. 

```

```{r map_files, echo=FALSE, warning=FALSE}
# Getting map of the whole world, downloaded from  
#http://thematicmapping.org/downloads/world_borders.php : 

unzip("TM_WORLD_BORDERS_SIMPL-0.3.zip") 

world_map <- read_sf("TM_WORLD_BORDERS_SIMPL-0.3.shp")

# https://gadm.org/data.html 

  
```

```{r gdp_vs_immigration, echo=FALSE, message=FALSE}

ggplot(qog, aes(x = fe_etfra, y = wdi_migration)) + 
  geom_point() +
  scale_y_continuous() + 
  theme_light() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

fit = lm(wdi_migration ~ unna_gdppc, qog)
summary(fit)

```


```{r}
ggplot(world_map) + 
  geom_sf() + 
  theme_light()


```

